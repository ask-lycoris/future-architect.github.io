<div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li class="active">Categories</li>
  </ul>

  <section id="main" class="margin-top-30">

    <div class="widget">
      <h2 class="list-page">カテゴリ別 投稿数の推移（四半期ごと）</h2>
      ※2018年以前は年単位で表示
      <div id="category-chart" style="width: 100%; height: 400px;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5.1.2/dist/echarts.min.js"></script>

    <script type="text/javascript">
      const chartData = <%- JSON.stringify(get_quarterly_category_data()) %>;
      const myChart = echarts.init(document.getElementById('category-chart'));
      const option = {
        tooltip: { trigger: 'axis', axisPointer: { type: 'cross', label: { backgroundColor: '#6a7985' } } },
        legend: { data: chartData.categories, type: 'scroll', orient: 'horizontal', left: 'center', top: 'bottom' },
        grid: { left: '3%', right: '4%', bottom: '15%', containLabel: true },
        xAxis: [ { type: 'category', boundaryGap: false, data: chartData.quarters } ],
        yAxis: [ { name: '投稿数', type: 'value' } ],
        series: chartData.series
      };
      myChart.setOption(option);
    </script>

    <br>
    <div class="widget">
      <h2 class="list-page">カテゴリから記事を探す</h2>
      <div class="widget">
        <ul class="nav margin-bottom-40">
        <%
          const compareFunc = (a, b) => b.posts.length - a.posts.length;
          const categoryRanks = site.categories.data.sort(compareFunc)

          let categoryListHTML = "";
          categoryRanks.forEach(function(c) {
            let className = "";
            if (is_category(c.name)) {
              className = "category-list-current"
            }
            categoryListHTML += `<li class="${className}"><a href="${url_for(c.path)}">${c.name} (${c.length})</a></li>\n`
          });
        %>
        <%- categoryListHTML %>
        </ul>
      </div>
  </section>
</div>
